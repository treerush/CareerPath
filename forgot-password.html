<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Parolni tiklash — CareerPath</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root{
      --primary:#4CAF50;
      --bg:#f6f8fa;
      --card:#fff;
      --text:#222;
      --muted:#666;
    }
    body{font-family:Inter, Poppins, system-ui, sans-serif;margin:0;background:var(--bg);color:var(--text);display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px}
    .card{width:100%;max-width:520px;background:var(--card);padding:28px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.06)}
    h1{margin:0 0 8px;font-size:20px;color:var(--primary)}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .form-group{margin-bottom:14px}
    label{display:block;margin-bottom:6px;font-weight:600}
    input[type="email"]{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:8px;font-size:15px;box-sizing:border-box}
    .btn{display:inline-block;padding:10px 16px;background:var(--primary);color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:600}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .hint{margin-top:12px;color:var(--muted);font-size:14px}
    .links{margin-top:18px;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .links a{color:var(--primary);text-decoration:none;font-weight:600}
    .message{margin-top:12px;padding:12px;border-radius:8px;font-size:14px}
    .message.success{background:#e6ffef;color:#0b6b2f;border:1px solid #b7f3c6}
    .message.error{background:#fff1f0;color:#8b1f1f;border:1px solid #f5c6c6}
    .center{text-align:center}
    .small{font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="title">
    <h1 id="title">Parolni tiklash</h1>
    <p class="lead">Elektron pochtangizga parolni tiklash uchun havola yuboramiz. Iltimos, pastdagi maydonga hisobingizga tegishli elektron pochtani kiriting.</p>

    <form id="reset-form" autocomplete="off" novalidate>
      <div class="form-group">
        <label for="email">Email</label>
        <input id="email" type="email" placeholder="email@misol.com" required autocomplete="email" />
      </div>

      <div class="form-group">
        <button id="reset-btn" type="submit" class="btn">Parolni tiklash havolasini yuborish</button>
      </div>
    </form>

    <div id="message-area" aria-live="polite"></div>

    <p class="hint">Agar xabar kelmasa, spam/junk papkangizni tekshiring yoki email manzilingizni to‘g‘ri kiritganingizga ishonch hosil qiling.</p>

    <div class="links">
      <a href="login.html">← Login sahifasiga qaytish</a>
      <span class="small"> | </span>
      <a href="register.html">Ro'yxatdan o'tish</a>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

    // --- Firebase config (o'zingizning loyihangizdagi config bilan almashtiring agar kerak bo'lsa) ---
    const firebaseConfig = {
      apiKey: "AIzaSyA86zhSVi4FSw-GvFBdOZsCPaHMS67XA78",
      authDomain: "carrer-path-a5810.firebaseapp.com",
      projectId: "carrer-path-a5810",
      storageBucket: "carrer-path-a5810.firebasestorage.app",
      messagingSenderId: "693831778129",
      appId: "1:693831778129:web:911293c5c284eefe295d70"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const form = document.getElementById('reset-form');
    const emailInput = document.getElementById('email');
    const resetBtn = document.getElementById('reset-btn');
    const messageArea = document.getElementById('message-area');

    function showMessage(text, type = 'success') {
      messageArea.innerHTML = '';
      const div = document.createElement('div');
      div.className = `message ${type === 'success' ? 'success' : 'error'}`;
      div.textContent = text;
      messageArea.appendChild(div);
    }

    function clearMessage() {
      messageArea.innerHTML = '';
    }

    function setProcessing(on) {
      resetBtn.disabled = on;
      resetBtn.textContent = on ? 'Yuborilmoqda...' : 'Parolni tiklash havolasini yuborish';
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearMessage();

      const email = (emailInput.value || '').trim();
      if (!email) {
        showMessage("Iltimos, email manzilingizni kiriting.", 'error');
        return;
      }

      setProcessing(true);

      try {
        await sendPasswordResetEmail(auth, email);
        showMessage("Parolni tiklash havolasi sizning emailingizga yuborildi. (Agar kelmasa, spam papkasini tekshiring.)", 'success');

        // ixtiyoriy: avtomatik login sahifasiga o'tish uchun 6s kutib keyin taklif ko'rsating
        const goLogin = document.createElement('div');
        goLogin.className = 'small center';
        goLogin.style.marginTop = '10px';
        goLogin.innerHTML = `Hozir <a href="login.html">login</a> sahifasiga qaytishingiz mumkin.`;
        messageArea.appendChild(goLogin);

      } catch (err) {
        console.error("sendPasswordResetEmail error:", err);
        // xatolikni foydalanuvchi tushunadigan holatda ko'rsatish
        let msg = "Xatolik yuz berdi. Iltimos, qayta urinib ko'ring.";
        if (err && err.code) {
          switch (err.code) {
            case 'auth/invalid-email':
              msg = "Kiritilgan email manzil noto‘g‘ri formatda.";
              break;
            case 'auth/user-not-found':
              msg = "Bunday email bilan ro'yxatdan olingan foydalanuvchi topilmadi.";
              break;
            case 'auth/too-many-requests':
              msg = "Ko‘p urinishlar aniqlandi. Bir muddatdan keyin qayta urinib ko‘ring.";
              break;
            default:
              // agar Firebase xabari mavjud bo'lsa, uni ko'rsatish mumkin:
              msg = err.message || msg;
          }
        }
        showMessage(msg, 'error');
      } finally {
        setProcessing(false);
      }
    });
  </script>
</body>
</html>
